# Changes Made - January 18, 2025

## Summary
Fixed "Send to POST" functionality and improved button hover detection across all pages.

## Changes Made

### 1. Fixed BILLBACK "Send to POST" Button (main.py)

**File:** `main.py` (lines 3064-3097)

**Problem:** When clicking "Send to POST" button on BILLBACK page, bills were copied from Stage 7 to Stage 6 but remained in Stage 7 (BILLBACK).

**Solution:** Added deletion after copy to complete the MOVE operation:

```python
# Copy from Stage 7 to Stage 6
s3.copy_object(
    Bucket=BUCKET,
    CopySource={"Bucket": BUCKET, "Key": bill_id},
    Key=stage6_key
)

# Delete from Stage 7 (BILLBACK) to complete the move
s3.delete_object(Bucket=BUCKET, Key=bill_id)
```

- Updated docstring from "Send" to "Move"
- Updated log message from "Copied" to "Moved"
- Added `"moved": True` flag to response

### 2. Updated "Send to POST" Button Styling (billback.html)

**File:** `templates/billback.html` (line 1170-1173)

**Changed from:**
- Orange background (`#f97316`)
- White text

**Changed to:**
- Fade blue/gray background (`#f3f4f6`)
- Black text (`#000`)
- Black outline (`border:1px solid #000`)

Now matches other buttons on the page.

### 3. Updated Confirmation Message (billback.html)

**File:** `templates/billback.html` (line 711)

**Changed from:**
```javascript
'Send this bill back to POST (Stage 6) for reprocessing?\n\nThis will copy the bill from Stage 7 back to Stage 6.'
```

**Changed to:**
```javascript
'Send this bill back to POST (Stage 6) for reprocessing?\n\nThis will MOVE the bill from Stage 7 (BILLBACK) back to Stage 6 (POST).'
```

### 4. Fixed Button Hover/Click Detection Issues

**Problem:** Home page buttons required hovering for a while before being clickable due to missing z-index values on sticky headers and tiles.

**Solution:** Added proper z-index layering to all templates:

#### Home Page Tiles - Added cursor and z-index:
- `templates/landing.html` - Added `cursor:pointer; position:relative; z-index:1` to `.tile` class
- `templates/index.html` - Added `position:relative; z-index:1` to `.card` class
- `templates/config_menu.html` - Added `cursor:pointer; position:relative; z-index:1` to `.tile` class

#### Sticky Headers - Added z-index:100 to ALL pages (13 files):
1. `templates/landing.html`
2. `templates/index.html`
3. `templates/config_menu.html`
4. `templates/review.html`
5. `templates/input.html`
6. `templates/invoices.html`
7. `templates/post.html`
8. `templates/track.html`
9. `templates/uom_mapping.html`
10. `templates/ap_team.html`
11. `templates/ap_mapping.html`
12. `templates/gl_code_mapping.html`
13. `templates/ubi_mapping.html`

Changed from:
```css
header.top{position:sticky;top:0;...;color:#fff}
```

Changed to:
```css
header.top{position:sticky;top:0;...;color:#fff;z-index:100}
```

## Git Commit

**Commit ID:** `322b486`

**Commit Message:**
```
fix: move bills from BILLBACK to POST and improve button hover detection

- Changed send-to-post endpoint to MOVE bills instead of copy (deletes from Stage 7 after copying to Stage 6)
- Updated billback.html: changed Send to POST button to fade blue with black outline
- Fixed button hover/click detection across all templates:
  - Added z-index:100 to all sticky headers (13 files)
  - Added cursor:pointer and z-index:1 to home page tiles (landing.html, index.html, config_menu.html)
- Updated confirmation message to clarify it's a MOVE operation

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
```

## Deployment

**Status:** âœ… Successfully deployed

**CodeBuild ID:** `jrk-bill-review-build:384c5709-0062-4ff6-a3db-c7ccdcb61fc1`

**Deployment Steps:**
1. âœ… Logged into AWS SSO (profile: jrk-analytics-admin)
2. âœ… Created source zip (144.8 MB)
3. âœ… Uploaded to S3: `s3://jrk-analytics-billing/tmp/jrk-bill-review/source.zip`
4. âœ… Started CodeBuild deployment

**Estimated completion:** 2-3 minutes from start time

## Testing Checklist

After reboot, verify:
- [ ] "Send to POST" button on BILLBACK page is fade blue with black outline
- [ ] Clicking "Send to POST" shows "MOVE" in confirmation dialog
- [ ] After confirming, bill disappears from BILLBACK (Stage 7) and moves to POST (Stage 6)
- [ ] Home page tiles are immediately clickable on hover (no delay)
- [ ] All page headers stay on top when scrolling

## Files Modified

Total: 15 files changed, 738 insertions(+), 190 deletions(-)

1. `main.py`
2. `templates/ap_mapping.html`
3. `templates/ap_team.html`
4. `templates/billback.html`
5. `templates/config_menu.html`
6. `templates/gl_code_mapping.html`
7. `templates/index.html`
8. `templates/input.html`
9. `templates/invoices.html`
10. `templates/landing.html`
11. `templates/post.html`
12. `templates/review.html`
13. `templates/track.html`
14. `templates/ubi_mapping.html`
15. `templates/uom_mapping.html`
